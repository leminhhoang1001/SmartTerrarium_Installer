<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>C√†i ƒë·∫∑t Smart Terrarium Firmware</title>
    <script type="module" src="https://unpkg.com/esp-web-tools@10/dist/web/install-button.js?module"></script>
    <link rel="stylesheet" href="terra-style.css">
</head>
<body>

    <div class="container">
        <button id="lang-btn" onclick="toggleLanguage()">
            üáªüá≥ VN
        </button>

        <h1>üåø Smart Terrarium</h1>
        <p data-lang="desc">C√¥ng c·ª• n·∫°p ph·∫ßn m·ªÅm t·ª± ƒë·ªông cho h·ªá th·ªëng chƒÉm s√≥c b·ªÉ b√°n c·∫°n th√¥ng minh.</p>

        <div class="browser-support" id="browser-msg" data-lang="browser_msg">
            ‚ö†Ô∏è Y√™u c·∫ßu tr√¨nh duy·ªát: Chrome, Edge ho·∫∑c Opera tr√™n m√°y t√≠nh.
        </div>

        <div class="warning-box">
            <div style="font-weight: bold; margin-bottom: 5px;">‚ö†Ô∏è <span data-lang="warn_title">L∆ØU √ù QUAN TR·ªåNG:</span></div>
            <span data-lang="warn_content">
                ƒê·ªÉ tr√°nh l·ªói d·ªØ li·ªáu c≈©, t·∫°i b∆∞·ªõc x√°c nh·∫≠n c√†i ƒë·∫∑t, vui l√≤ng t√≠ch ch·ªçn:
            </span><br>
            <span class="highlight-erase">‚úÖ Erase device (X√≥a thi·∫øt b·ªã)</span>
        </div>

        <div class="steps">
            <h3 data-lang="step_title">H∆∞·ªõng d·∫´n c√†i ƒë·∫∑t:</h3>
            <ol>
                <li data-lang="step_1">K·∫øt n·ªëi m·∫°ch ESP32 v√†o m√°y t√≠nh qua c√°p USB.</li>
                <li data-lang="step_2">Nh·∫•n n√∫t <b>"CONNECT"</b> b√™n d∆∞·ªõi.</li>
                <li data-lang="step_3">Ch·ªçn c·ªïng COM c·ªßa m·∫°ch v√† nh·∫•n <b>"K·∫øt n·ªëi"</b>.</li>
                <li data-lang="step_4">Ch·ªçn <b>"INSTALL SMART TERRARIUM"</b> v√† ch·ªù ƒë·ª£i.</li>
            </ol>
        </div>

        <esp-web-install-button 
            manifest="manifest.json"
        >
            <button slot="activate" id="connect-btn" style="
                background: #2e8b57; 
                color: white; 
                border: none; 
                padding: 12px 30px; 
                border-radius: 50px; 
                font-size: 16px; 
                font-weight: bold; 
                cursor: pointer; 
                box-shadow: 0 4px 15px rgba(46, 139, 87, 0.4);
                transition: transform 0.2s;
            " onmouseover="this.style.transform='scale(1.05)'" 
              onmouseout="this.style.transform='scale(1)'">
                üöÄ <span data-lang="btn_connect">K·∫æT N·ªêI & C√ÄI ƒê·∫∂T</span>
            </button>
        </esp-web-install-button>

        <div class="driver-note">
            <span data-lang="note_driver_text">Kh√¥ng t√¨m th·∫•y thi·∫øt b·ªã? H√£y c√†i ƒë·∫∑t</span> 
            <a href="https://www.silabs.com/developers/usb-to-uart-bridge-vcp-drivers" target="_blank" data-lang="driver_cp">Driver CP210x</a> 
            <span data-lang="note_or">ho·∫∑c</span> 
            <a href="https://wch.cn/downloads/CH341SER_ZIP.html" target="_blank" data-lang="driver_ch">CH340</a>.
        </div>
    </div>

    <script>
        const flags = {
            vi: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCA5MDAgNjAwIj48cGF0aCBmaWxsPSIjZGEyNTFkIiBkPSJNMCAwaDkwMHY2MDBIMHoiLz48cGF0aCBmaWxsPSIjZmZmZjAwIiBkPSJNNDUwIDEyNWw5Mi44IDI4NS42LTI0Mi45LTE3Ni41aDMwMC4yTDM1Ny4yIDQxMC42eiIvPjwvc3ZnPg==',
            en: 'data:image/svg+xml;base64,PHN2ZyB4bWxucz0iaHR0cDovL3d3dy53My5vcmcvMjAwMC9zdmciIHZpZXdCb3g9IjAgMCAxMjM1IDY1MCI+PHBhdGggZD0iTTAgMGgxMjM1djY1MEgwWiIgZmlsbD0iI2ZmZiIvPjxwYXRoIGQ9Ik0wIDkyaDEyMzVNMCAyMTRoMTIzNU0wIDMzN2gxMjM1TTAgNDU5aDEyMzVNMCA1ODJoMTIzNSIgc3Ryb2tlPSIjYmUyYTM4IiBzdHJva2Utd2lkdGg9IjYxLjUiLz48cGF0aCBkPSJNMCAwaDQ5NHYzNzFIMFoiIGZpbGw9IiMzYzNiNmUiLz48ZyBmaWxsPSIjZmZmIj48ZyBpZD0icyI+PGcgaWQ9ImMiPjxwYXRoIGlkPSJ0IiBkPSJNMjQ3IDE4bDEwIDI4SDIzN2wxMCAyOHoiLz48dXNlIHhyZWY9IiN0IiB4PSIyNSIvPjx1c2UgeHJlZj0iI3QiIHg9IjUwIi8+PHVzZSB4cmVmPSIjdCIgeD0iNzUiLz48dXNlIHhyZWY9IiN0IiB4PSIxMDAiLz48L2c+PHVzZSB4cmVmPSIjYyIgeT0iMjUiLz48dXNlIHhyZWY9IiNjIiB5PSI1MCIvPjx1c2UgeHJlZj0iI2MiIHk9Ijc1Ii8+PHVzZSB4cmVmPSIjYyIgeT0iMTAwIi8+PC9nPjx1c2UgeHJlZj0iI3MiIHk9IjEzIiB4PSIxMyIvPjx1c2UgeHJlZj0iI3MiIHk9IjM4IiB4PSIxMyIvPjx1c2UgeHJlZj0iI3MiIHk9IjYzIiB4PSIxMyIvPjx1c2UgeHJlZj0iI3MiIHk9Ijg4IiB4PSIxMyIvPjwvZz48L3N2Zz4='
        };

        const translations = {
            vi: {
                desc: "C√¥ng c·ª• n·∫°p ph·∫ßn m·ªÅm t·ª± ƒë·ªông cho h·ªá th·ªëng chƒÉm s√≥c b·ªÉ b√°n c·∫°n th√¥ng minh.",
                browser_msg: "‚ö†Ô∏è Y√™u c·∫ßu tr√¨nh duy·ªát: Chrome, Edge ho·∫∑c Opera tr√™n m√°y t√≠nh.",
                
                // --- PH·∫¶N D·ªäCH C·∫¢NH B√ÅO M·ªöI ---
                warn_title: "L∆ØU √ù QUAN TR·ªåNG:",
                warn_content: "ƒê·ªÉ tr√°nh l·ªói d·ªØ li·ªáu c≈©, t·∫°i b∆∞·ªõc x√°c nh·∫≠n c√†i ƒë·∫∑t, vui l√≤ng t√≠ch ch·ªçn:",
                // ------------------------------

                step_title: "H∆∞·ªõng d·∫´n c√†i ƒë·∫∑t:",
                step_1: "K·∫øt n·ªëi m·∫°ch ESP32 v√†o m√°y t√≠nh qua c√°p USB.",
                step_2: "Nh·∫•n n√∫t <b>\"CONNECT\"</b> b√™n d∆∞·ªõi.",
                step_3: "Ch·ªçn c·ªïng COM c·ªßa m·∫°ch v√† nh·∫•n <b>\"K·∫øt n·ªëi\"</b>.",
                step_4: "Ch·ªçn <b>\"INSTALL SMART TERRARIUM\"</b> v√† ch·ªù ƒë·ª£i.",
                btn_connect: "K·∫æT N·ªêI & C√ÄI ƒê·∫∂T",
                note_driver_text: "Kh√¥ng t√¨m th·∫•y thi·∫øt b·ªã? H√£y c√†i ƒë·∫∑t",
                driver_cp: "Driver CP210x",
                note_or: "ho·∫∑c",
                driver_ch: "CH340"
            },
            en: {
                desc: "Automated firmware flashing tool for the Smart Terrarium system.",
                browser_msg: "‚ö†Ô∏è Browser Requirement: Chrome, Edge, or Opera on Desktop.",
                
                // --- TRANSLATION FOR NEW WARNING ---
                warn_title: "IMPORTANT NOTE:",
                warn_content: "To avoid old data conflicts, at the confirmation step, please check:",
                // -----------------------------------

                step_title: "Installation Guide:",
                step_1: "Connect ESP32 board to PC via USB cable.",
                step_2: "Click the <b>\"CONNECT\"</b> button below.",
                step_3: "Select the device COM port and click <b>\"Connect\"</b>.",
                step_4: "Select <b>\"INSTALL SMART TERRARIUM\"</b> and wait.",
                btn_connect: "CONNECT & INSTALL",
                note_driver_text: "Device not found? Install drivers:",
                driver_cp: "CP210x Driver",
                note_or: "or",
                driver_ch: "CH340"
            }
        };

        let currentLang = localStorage.getItem('installer_lang') || 'vi';

        function toggleLanguage() {
            currentLang = currentLang === 'vi' ? 'en' : 'vi';
            localStorage.setItem('installer_lang', currentLang);
            applyLanguage();
        }

        function applyLanguage() {
            const t = translations[currentLang];
            document.querySelectorAll('[data-lang]').forEach(el => {
                const key = el.getAttribute('data-lang');
                if (t[key]) el.innerHTML = t[key];
            });
            const btn = document.getElementById('lang-btn');
            const flagSrc = currentLang === 'vi' ? flags.vi : flags.en;
            btn.innerHTML = `<img src="${flagSrc}" class="flag-icon"> ${currentLang.toUpperCase()}`;
        }

        if ("serial" in navigator) {
            document.getElementById("browser-msg").style.display = "none";
        } else {
            document.getElementById("browser-msg").style.display = "block";
        }

        applyLanguage();

    </script>
</body>
</html>